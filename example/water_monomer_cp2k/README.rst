Generate training data using CP2K
----------------------------------

In what follows, we describe how to generate training electron densities to be used in SALTED using the CP2K electronic-structure program. 

1. The following input arguments must be included in the :code:`inp.qm` section:

   :code:`qmcode`: define quantum-mechanical code as :code:`cp2k`

   :code:`path2qm`: set the path where the CP2K data are going to be saved

   :code:`periodic`: set the periodicity of the system (:code:`0D,2D,3D`)

   :code:`coeffile`: filename of RI density coefficients as printed by CP2K

   :code:`ovlpfile`: filename of 2-center RI integrals as printed by CP2K

   :code:`dfbasis`: RI (density-fitting) basis filename appended for each species, extracted from CP2K 

   :code:`pseudocharge`: list of pseudocharges associated with the adopted GTH pseudopotential. NB: the list ordering must be consistent with the ordering of species provided in :code:`inp.system.species`.
   
2. Initialize the systems used for the CP2K calculation by running:

   :code:`python3 -m salted.cp2k.xyz2sys`

   System cells and coordinates are extracted from the configuration dataset in XYZ format and saved in folders named :code:`conf_1`, :code:`conf_2`, ...  located in the path :code:`inp.qm.path2qm`. NB: cell information (Lattice) must be included in second line of each XYZ configuration, even if it does not change.

3. Run SCF calculations and save the optimized wavefunction for each configuration in the corresponding folders previously generated. An example CP2K input is provided in :code:`cp2k-inputs/SCF.inp`. 

4. Print the RI density-fitting coefficients and 2-center RI integrals by restarting the CP2K calculation from the optimized wavefunction. This restart operation derives from the large memory required by the RI fitting procedure, which might require using larger computational resources than the plain SCF cycle. An example CP2K input is provided in :code:`cp2k-inputs/rho-RI-print.inp`. NB: The RI basis is automatically generated by CP2K from the selected wavefunction basis set, as described in https://doi.org/10.1021/acs.jctc.6b01041, following SMALL, MEDIUM, or LARGE tiers. 
   
5. Print the RI basis set information required for SALTED postprocessing of the CP2K density. An example CP2K input is provided in :code:`cp2k-inputs/RI-basis.inp`. This operation can be performed only once for any arbitrary configuration included in the dataset adopting the given choice of RI basis. The output is a single file including wavefunction and RI basis set information of all the species included in the selected test configuration. To extract the RI basis information for each species, run

   :code:`python3 -m salted.cp2k.extract_basis cp2k_basis_filename`

   with :code:`cp2k_basis_filename` the output basis set filename. This will create a separate file for each species in the format, e.g., H-:code:`dfbasis`, O-:code:`dfbasis`.

6. Add the RI basis set information to SALTED by running:

   :code:`python3 -m salted.get_basis_info`

7. Set the :code:`inp.qm.coeffile` and :code:`inp.qm.ovlpfile` input arguments according to the filenames of the RI density-fitting coefficients and 2-center RI integrals generated at 4. Then, convert the full training dataset in SALTED format by running:

   :code:`python3 -m salted.cp2k.cp2k2salted`
